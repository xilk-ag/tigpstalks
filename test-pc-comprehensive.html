<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIGPS PC - Final Comprehensive Test</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="script.js"></script>
    <script src="final-verification-pc.js"></script>
    <style>
        .test-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 10000;
            max-width: 300px;
            font-size: 12px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.success {
            background: #28a745;
        }
        .test-button.error {
            background: #dc3545;
        }
        .test-button.warning {
            background: #ffc107;
            color: #000;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-indicator.success {
            background: #28a745;
        }
        .status-indicator.error {
            background: #dc3545;
        }
        .status-indicator.warning {
            background: #ffc107;
        }
        .status-indicator.info {
            background: #17a2b8;
        }
    </style>
</head>
<body>
    <!-- Test Control Panel -->
    <div class="test-panel">
        <h4>🧪 PC Version Test Panel</h4>
        <div>
            <span class="status-indicator info"></span>
            <span id="testStatus">Ready for testing</span>
        </div>
        <hr style="margin: 10px 0; border-color: #444;">
        <button class="test-button" onclick="runQuickTest()">Quick Test</button>
        <button class="test-button success" onclick="runAllVerificationTests()">Full Test</button>
        <button class="test-button warning" onclick="testPostCreation()">Test Post</button>
        <button class="test-button" onclick="testNotifications()">Test Notifications</button>
        <button class="test-button" onclick="testFirebase()">Test Firebase</button>
        <button class="test-button" onclick="clearTestResults()">Clear Results</button>
        <hr style="margin: 10px 0; border-color: #444;">
        <div id="testResults" style="font-size: 10px; max-height: 100px; overflow-y: auto;"></div>
    </div>

    <!-- Username Modal -->
    <div id="usernameModal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:350px;text-align:center;">
        <div class="modal-header">
          <h2>Enter Your Details</h2>
        </div>
        <div class="modal-body">
          <input type="text" id="displayNameInput" class="modal-post-input" placeholder="Your name" maxlength="30" autocomplete="off" style="width:100%;margin-bottom:1rem;">
          <input type="text" id="usernameInput" class="modal-post-input" placeholder="Your username" maxlength="20" autocomplete="off" style="width:100%;margin-bottom:1rem;">
          <button id="usernameSubmitBtn" class="btn-primary" style="width:100%;">Continue</button>
        </div>
      </div>
    </div>

    <div class="stars"></div>
    <div class="stars-container">
        <div class="stars"></div>
        <div class="twinkling"></div>
        <div class="glitter"></div>
    </div>

    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="hamburger-menu" id="hamburgerMenu" onclick="toggleHamburgerMenu();">
                        <span class="hamburger-icon">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 12h18M3 6h18M3 18h18"/>
                          </svg>
                        </span>
                    </div>
                </div>
                
                <div class="header-center">
                    <img src="tigps.png" alt="TIGPS" class="tigps-logo">
                </div>
                
                <div class="header-right">
                    <button id="betaButton" style="background:#f7b500;color:#222;font-weight:700;border:none;padding:6px 18px;border-radius:16px;font-size:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-right:12px;cursor:pointer;transition:background 0.2s;">BETA</button>
                    
                    <button class="btn-mail" onclick="openMail()" title="Contact Us">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                    </button>
                    
                    <div class="user-menu" onclick="toggleProfileMenu();">
                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face" alt="Profile" class="profile-pic" id="headerProfilePic">
                        <div class="profile-menu" id="profileMenu">
                            <div class="profile-menu-item" onclick="openAccountDashboard(event)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                </svg>
                                Account
                            </div>
                            <div class="profile-menu-item" onclick="openProfileModal()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                                Edit Profile
                            </div>
                            <div class="profile-menu-item" onclick="openSettingsModal()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                                </svg>
                                Settings
                            </div>
                            <div class="profile-menu-item" onclick="openMail()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                </svg>
                                Contact Us
                            </div>
                            <div class="profile-menu-item" onclick="openAdminModal()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>
                                </svg>
                                Admin
                            </div>
                            <div class="profile-menu-item" onclick="logout()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                                </svg>
                                Logout
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar Menu -->
        <div class="sidebar-menu" id="sidebarMenu">
            <div class="sidebar-header" style="display:flex;flex-direction:column;align-items:center;">
                <img src="tigps.png" alt="TIGPS" class="tigps-logo" style="height:80px;width:auto;margin-bottom:1rem;">
                <button class="close-sidebar-btn" onclick="toggleHamburgerMenu()">×</button>
            </div>
            <div class="sidebar-content">
                <div class="sidebar-item" onclick="openAccountDashboard(event)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    Edit Account
                </div>
                <div class="sidebar-item" onclick="openProfileModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                    </svg>
                    Edit Profile
                </div>
                <div class="sidebar-item" onclick="openAdminModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>
                    </svg>
                    Admin Page
                </div>
                <div class="sidebar-item" onclick="openSettingsModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </svg>
                    Settings
                </div>
                <div class="sidebar-item" onclick="openMail()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                    Contact Us
                </div>
                <div class="sidebar-item" onclick="logout()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                    Logout
                </div>
            </div>
        </div>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleHamburgerMenu()"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Post Creation Area -->
                <div class="post-creator">
                    <div class="post-input-container">
                        <div class="post-header-section">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=48&h=48&fit=crop&crop=face" alt="Profile" class="post-avatar" id="postCreatorAvatar">
                            <div class="post-creator-info">
                                <div class="post-creator-name" id="postCreatorName">@alexchen</div>
                                <div class="post-creator-display-name" id="postCreatorDisplayName">Alex Chen</div>
                            </div>
                        </div>
                        <textarea 
                            id="postInput" 
                            placeholder="What's happening at TIGPS?" 
                            class="post-input"
                            maxlength="500"
                        ></textarea>
                        <div class="post-media-preview" id="postMediaPreview"></div>
                        <div class="post-actions">
                            <div class="post-options">
                                <button class="media-btn" onclick="triggerImageUpload()">
                                    <div class="media-btn-content">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                                        </svg>
                                        <span>Add Image</span>
                                    </div>
                                </button>
                                <button class="media-btn gif-btn" onclick="openGifSearch()">
                                    <div class="media-btn-content">
                                        <img src="gif.jpg" alt="GIF" width="16" height="16" style="object-fit: cover; border-radius: 2px;">
                                        <span>Add GIF</span>
                                    </div>
                                </button>
                                <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="anonymousPost">
                                    <span class="checkmark"></span>
                                    Post Anonymously
                                </label>
                            </div>
                            <div class="post-submit">
                                <div class="char-count" id="charCount">0/500</div>
                                <button class="btn-post" onclick="createPost()" id="postButton">Post</button>
                                <button class="btn-secondary" onclick="createTestPost()" id="testPostButton" style="margin-left:10px;">Test Post</button>
                                <button class="btn-secondary" onclick="forceLoadPosts()" id="forceLoadButton" style="margin-left:10px;background:#ff6b6b;">Force Load Posts</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Posts Feed -->
                <div class="posts-feed" id="postsFeed">
                    <!-- Posts will be rendered here -->
                </div>
            </div>
        </main>
    </div>

    <!-- All modals and other components will be loaded from the main script -->

    <script>
        // Test functions for the control panel
        function updateTestStatus(message, type = 'info') {
            document.getElementById('testStatus').textContent = message;
            const indicator = document.querySelector('.status-indicator');
            indicator.className = `status-indicator ${type}`;
        }

        function addTestResult(message) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `[${timestamp}] ${message}\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function runQuickTest() {
            updateTestStatus('Running quick test...', 'info');
            addTestResult('Starting quick test...');
            
            let passed = 0;
            let total = 0;
            
            // Test 1: Basic functions
            total++;
            if (typeof createPost === 'function') {
                passed++;
                addTestResult('✅ createPost function available');
            } else {
                addTestResult('❌ createPost function missing');
            }
            
            // Test 2: DOM elements
            total++;
            if (document.getElementById('postInput')) {
                passed++;
                addTestResult('✅ postInput element found');
            } else {
                addTestResult('❌ postInput element missing');
            }
            
            // Test 3: Firebase
            total++;
            if (typeof firebase !== 'undefined') {
                passed++;
                addTestResult('✅ Firebase SDK loaded');
            } else {
                addTestResult('❌ Firebase SDK missing');
            }
            
            // Test 4: Notifications
            total++;
            if (typeof showNotification === 'function') {
                passed++;
                addTestResult('✅ showNotification function available');
                showNotification('Quick test notification!', 'success');
            } else {
                addTestResult('❌ showNotification function missing');
            }
            
            const percentage = Math.round((passed / total) * 100);
            updateTestStatus(`Quick test: ${passed}/${total} passed (${percentage}%)`, percentage >= 75 ? 'success' : 'error');
            addTestResult(`Quick test complete: ${passed}/${total} passed (${percentage}%)`);
        }

        function testPostCreation() {
            updateTestStatus('Testing post creation...', 'info');
            addTestResult('Testing post creation...');
            
            try {
                if (typeof createTestPost === 'function') {
                    createTestPost();
                    addTestResult('✅ Test post creation initiated');
                    updateTestStatus('Test post created!', 'success');
                } else {
                    addTestResult('❌ createTestPost function missing');
                    updateTestStatus('Test post failed!', 'error');
                }
            } catch (error) {
                addTestResult(`❌ Test post error: ${error.message}`);
                updateTestStatus('Test post failed!', 'error');
            }
        }

        function testNotifications() {
            updateTestStatus('Testing notifications...', 'info');
            addTestResult('Testing notifications...');
            
            try {
                if (typeof showNotification === 'function') {
                    showNotification('Success notification test!', 'success');
                    setTimeout(() => showNotification('Error notification test!', 'error'), 1000);
                    setTimeout(() => showNotification('Warning notification test!', 'warning'), 2000);
                    setTimeout(() => showNotification('Info notification test!', 'info'), 3000);
                    addTestResult('✅ All notification types tested');
                    updateTestStatus('Notifications tested!', 'success');
                } else {
                    addTestResult('❌ showNotification function missing');
                    updateTestStatus('Notifications failed!', 'error');
                }
            } catch (error) {
                addTestResult(`❌ Notification test error: ${error.message}`);
                updateTestStatus('Notifications failed!', 'error');
            }
        }

        function testFirebase() {
            updateTestStatus('Testing Firebase...', 'info');
            addTestResult('Testing Firebase...');
            
            try {
                if (typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0) {
                    addTestResult('✅ Firebase app initialized');
                    updateTestStatus('Firebase working!', 'success');
                } else {
                    addTestResult('❌ Firebase not initialized');
                    updateTestStatus('Firebase failed!', 'error');
                }
            } catch (error) {
                addTestResult(`❌ Firebase test error: ${error.message}`);
                updateTestStatus('Firebase failed!', 'error');
            }
        }

        function clearTestResults() {
            document.getElementById('testResults').innerHTML = '';
            updateTestStatus('Results cleared', 'info');
        }

        // Initialize test panel
        document.addEventListener('DOMContentLoaded', function() {
            updateTestStatus('PC version loaded and ready', 'success');
            addTestResult('PC version test page loaded successfully');
        });
    </script>
</body>
</html> 